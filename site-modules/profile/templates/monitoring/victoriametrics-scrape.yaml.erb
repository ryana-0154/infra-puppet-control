# VictoriaMetrics scrape configuration
# Managed by Puppet - do not edit manually
#
# VictoriaMetrics uses Prometheus-compatible scrape config format

global:
  scrape_interval: 15s
  # Note: evaluation_interval is not used by VictoriaMetrics single-node
  # (only relevant for Prometheus alerting/recording rules)

scrape_configs:
  # Scrape VictoriaMetrics itself
  - job_name: 'victoriametrics'
    scrape_interval: 5s
    static_configs:
      - targets: ['<%= @monitoring_ip %>:<%= @victoriametrics_port %>']

<%- if @enable_node_exporter -%>
  - job_name: 'node'
    scrape_interval: 15s
    static_configs:
      - targets: ['<%= @monitoring_ip %>:9100']
<%- end -%>

<%- if @enable_blackbox -%>
  # Blackbox exporter for HTTP/HTTPS probing
  # To enable monitoring, uncomment and configure targets below:
  #
  # - job_name: 'blackbox'
  #   metrics_path: /probe
  #   params:
  #     module: [http_2xx]
  #   static_configs:
  #     - targets:
  #       - https://your-domain.com
  #       - http://10.10.10.1  # Pi-hole web interface
  #   relabel_configs:
  #     - source_labels: [__address__]
  #       target_label: __param_target
  #     - source_labels: [__param_target]
  #       target_label: instance
  #     - target_label: __address__
  #       replacement: <%= @monitoring_ip %>:9115
<%- end -%>

<%- if @enable_pihole_exporter -%>
  - job_name: 'pihole'
    scrape_interval: 30s
    static_configs:
      - targets: ['<%= @monitoring_ip %>:<%= @pihole_exporter_port %>']
<%- end -%>

<%- if @enable_wireguard_exporter -%>
  - job_name: 'wireguard'
    scrape_interval: 15s
    static_configs:
      - targets: ['<%= @monitoring_ip %>:<%= @wireguard_exporter_port %>']
        labels:
          instance: 'wireguard'
<%- end -%>

<%- if @enable_unbound_exporter -%>
  - job_name: 'unbound'
    scrape_interval: 30s
    static_configs:
      - targets: ['<%= @monitoring_ip %>:<%= @unbound_exporter_port %>']
        labels:
          instance: 'unbound'
<%- end -%>
