---
# Node-specific configuration for vps.ra-home.co.uk

profile::base::manage_firewall: true
profile::base::manage_logrotate: true
profile::base::manage_otel_collector: true
profile::base::manage_unattended_upgrades: true
profile::base::manage_ssh_hardening: true

# Unattended Upgrades Configuration (Automatic Security Updates)
# As mentioned in the guide prerequisites
profile::unattended_upgrades::manage_unattended_upgrades: true
profile::unattended_upgrades::enable_auto_updates: true
profile::unattended_upgrades::update_interval: 1  # Check daily
profile::unattended_upgrades::download_upgradeable: true
profile::unattended_upgrades::auto_clean_interval: 7
profile::unattended_upgrades::remove_unused_kernel_packages: true
profile::unattended_upgrades::remove_unused_dependencies: true
profile::unattended_upgrades::automatic_reboot: true
profile::unattended_upgrades::mail_only_on_error: false
profile::unattended_upgrades::email: 'ENC[PKCS7,MIIBiQYJKoZIhvcNAQcDoIIBejCCAXYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEARrEKpDEHq9ozL8F9K5sE5MB9+YLnC6WCe//Z4KAaxMB9qwzBPquTC7UTkBnHutzWv7xdgVK430Ewd4Q28WafhOJjmpu3pfHCo3UXljigdPIrP1t+EWGfdv/PFkfsrnHPIsqm+Zpjx73/+/nUj8rYjOolevc0HSQalcxn/NMlqA6u5KUGh+PrnfBY3VxCEgovY5IG5hiy7FwELwQ4aWo1LBerI+mFZxDwR3UKf1vSpAjbGoEdmq6y/rbT5DEqPlFe4eQ1y1kCkJjmD8S5s2SD9buYTKVhRWj9JskRjegA53k9S/FOWXSSVAMiZzsHaqX+P95niykge7rAiCUkBQI9nzBMBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBC3TCkeYr21XEFU5ak+RgwlgCDDb+giGosV4aQqNhMbfQIWsUmN6r/9IdB/aU0beRw79A==]'  # Optional: Set email for notifications

# Unbound DNS resolver configuration
profile::unbound::manage_unbound: true
profile::unbound::listen_interface: '127.0.0.1'
profile::unbound::listen_port: 5353
profile::unbound::num_threads: 4
profile::unbound::enable_ipv6: false
profile::unbound::access_control:
  '0.0.0.0/0': 'refuse'
  '127.0.0.1/32': 'allow'
  '10.10.10.0/24': 'allow'

# Monitoring configuration
profile::monitoring::manage_monitoring: true
profile::monitoring::monitoring_dir: '/opt/monitoring_test'
profile::monitoring::monitoring_ip: '10.10.10.1'  # Listen on all interfaces for VPS

# Service ports
profile::monitoring::prometheus_port: 9090
profile::monitoring::grafana_port: 3000
profile::monitoring::blackbox_port: 9115
profile::monitoring::pihole_exporter_port: 9617
profile::monitoring::wireguard_exporter_port: 9586
profile::monitoring::unbound_exporter_port: 9167

# Enable/disable services
profile::monitoring::enable_prometheus: true
profile::monitoring::enable_grafana: true
profile::monitoring::enable_loki: true       # Log aggregation server
profile::monitoring::enable_promtail: true   # Log collection agent
profile::monitoring::enable_pihole_exporter: true  # Disable if no PiHole
profile::monitoring::enable_blackbox: true
profile::monitoring::enable_node_exporter: true
profile::monitoring::enable_wg_portal: true  # Disable if no WireGuard
profile::monitoring::enable_wireguard_exporter: true  # WireGuard metrics
profile::monitoring::enable_unbound_exporter: true    # Unbound DNS metrics

# WireGuard exporter configuration
profile::monitoring::wireguard_config_path: '/etc/wireguard'

# Unbound exporter configuration
profile::monitoring::unbound_host: '127.0.0.1'
profile::monitoring::unbound_control_port: 8953

# PiHole configuration (if enabled)
profile::monitoring::pihole_hostname: '10.10.10.1'
profile::monitoring::pihole_port: 80
profile::monitoring::pihole_protocol: 'http'
profile::monitoring::pihole_interval: '30s'

# Image versions (pin versions for stability in production)
profile::monitoring::prometheus_image: 'prom/prometheus:v2.45.0'
profile::monitoring::grafana_image: 'grafana/grafana:10.0.0'
profile::monitoring::loki_image: 'grafana/loki:3.1.1'
profile::monitoring::promtail_image: 'grafana/promtail:3.1.1'

profile::monitoring::grafana_admin_password: >
  ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAhQEC0uzDiu6Hi40tYToJQw2cJ4iOY6afssakMfB74W6cTwBPbVCDbDvdZUdhT2rhhVhtbqH+AG6smHdkhM5TbrWNiyQkryYf9ajf7OEKgQh/QRZvnkIn7WgvKbApkZXrYcOz0Nk8N9kc0x9FxuZuY+bIKhGYYEUnTVqakeAwjzqr5FJsZpH4EEpa+012Tgvbbh0OPA+sGmjffc3IR8Sv/Nej5upn2ef/769nGl/LBSiLPgppjQatworDIkJ9/J1EzEsUeXL2Qo6KPUKruCAjBUAYXUdkdgSM+UQSJKN5B9Blm4BxQ5+wFOt+DQUhIKcAG7dEkfcPZHTkxMgae1MXjTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCOBM/lDdp39fRSSbgLslpVgBBG1Rx+O1AwP39C/Fh8JWDa]
profile::monitoring::pihole_password: >
  ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAhQEC0uzDiu6Hi40tYToJQw2cJ4iOY6afssakMfB74W6cTwBPbVCDbDvdZUdhT2rhhVhtbqH+AG6smHdkhM5TbrWNiyQkryYf9ajf7OEKgQh/QRZvnkIn7WgvKbApkZXrYcOz0Nk8N9kc0x9FxuZuY+bIKhGYYEUnTVqakeAwjzqr5FJsZpH4EEpa+012Tgvbbh0OPA+sGmjffc3IR8Sv/Nej5upn2ef/769nGl/LBSiLPgppjQatworDIkJ9/J1EzEsUeXL2Qo6KPUKruCAjBUAYXUdkdgSM+UQSJKN5B9Blm4BxQ5+wFOt+DQUhIKcAG7dEkfcPZHTkxMgae1MXjTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCOBM/lDdp39fRSSbgLslpVgBBG1Rx+O1AwP39C/Fh8JWDa]

# Enable SSO components (disabled by default)
profile::monitoring::enable_authelia: true
profile::monitoring::enable_nginx_proxy: true
profile::monitoring::enable_redis: true

# Domain configuration (required for SSO)
profile::monitoring::domain_name: 'vps.ra-home.co.uk'

profile::monitoring::authelia_jwt_secret: >
  ENC[PKCS7,MIIBuQYJKoZIhvcNAQcDoIIBqjCCAaYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAPxyd4riyQiI29OWA7somWegxdo+0Wbdl5VeNvFI3RgNfYT/4bUJbVKzzbJsecL43pJm5wyQCDTCBeYVEBBQl8NOczHdjCPSeYQFRpjyZWfb1+ofAiy12Qz6RCTolzxpi7xKfKoSQDAK9cO7IY7MjwEY7dQOVXaxJsU2BedAmZUnmHvvXYZju3X0suprW+aqR4VEhzLv275Oe3oQk5hOsoOuA3Ubl8LTP7LiaHOTgLFMGInRjtTb4HoHqG5mtIaElfqTiiFKlCmAr7sd3fvM3hZFNogJI4F099d4w8JeDQGOJsFCl5O5H/3oBRi8K8SdgCz7zbZ+5yQM/mD+To9Wt7zB8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBeFZKriZVsyZ+WiiSylV1XgFD4tw7EjZ5i5T7qUQGRX2aWmksR2Ub2/42QrRnYP47vGtP2VKsiyG7/gXBqxVzJk7ffeqGYe7L0hAQD0PHNrbnGyZ17s4He633cHAcjy0Y91Q==]

profile::monitoring::authelia_session_secret: >
  ENC[PKCS7,MIIBuQYJKoZIhvcNAQcDoIIBqjCCAaYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAqblrThGILD256gWjMikvc8QZMkW+rm8C9zLjFUp/DK2bh6s5lCH6Al+XoAlS9ObfNLDvR/R1PSC8OaM3mgEuKQxixZUbWHPBi4X+kdD+PccT0KObKCvuORKvrCGimHy6L5fYY7aRLdMVUoeOzG09SHS57rqqaFTSVNzX2hl/Of5bfu4LqtuvqFULbSVMbsfVbgYYNdRJFvdH+ZtFbaD9jAdnGDrUlo5B7L8CtZJug9O76hwf80ohWoCtMGqv3z/nYMR81daXF3OKnAnPX/NFH4SOv0WSNrNxSKpbndFdzMUidPuMy932IuTYr9MINg1JwgYfBQfhp1wCm5Qfz+3XRTB8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBPirggUIg+ymXrrhjv6YV3gFCMxDY98Oqfl3K1wQGfg3yGveTULNl2o+a1F0571bcXu4FAUB/sZJ3UMWs8LjYvw6+JZzoPmdZMTp5XiMR1F9ZA/geXxUIbo8URswJWB4V2sQ==]

profile::monitoring::authelia_storage_encryption_key: >
  ENC[PKCS7,MIIBuQYJKoZIhvcNAQcDoIIBqjCCAaYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAPxyd4riyQiI29OWA7somWegxdo+0Wbdl5VeNvFI3RgNfYT/4bUJbVKzzbJsecL43pJm5wyQCDTCBeYVEBBQl8NOczHdjCPSeYQFRpjyZWfb1+ofAiy12Qz6RCTolzxpi7xKfKoSQDAK9cO7IY7MjwEY7dQOVXaxJsU2BedAmZUnmHvvXYZju3X0suprW+aqR4VEhzLv275Oe3oQk5hOsoOuA3Ubl8LTP7LiaHOTgLFMGInRjtTb4HoHqG5mtIaElfqTiiFKlCmAr7sd3fvM3hZFNogJI4F099d4w8JeDQGOJsFCl5O5H/3oBRi8K8SdgCz7zbZ+5yQM/mD+To9Wt7zB8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBeFZKriZVsyZ+WiiSylV1XgFD4tw7EjZ5i5T7qUQGRX2aWmksR2Ub2/42QrRnYP47vGtP2VKsiyG7/gXBqxVzJk7ffeqGYe7L0hAQD0PHNrbnGyZ17s4He633cHAcjy0Y91Q==]

profile::monitoring::grafana_oidc_secret: >
  ENC[PKCS7,MIIBuQYJKoZIhvcNAQcDoIIBqjCCAaYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAyq0Z1h3/ziFKKXzrJsUmxw4QIVLMZwXw7nnBRxKJJ4DJ6hiQ+4hzxqzQY9FtiURLteIQvrePQXhKIv2MTRV1l1UMEk6rayFGVpc0d5P0iDWFrArc+mI8xa5LX1x26t3nMuz2DXe4DMTskitdPdgXI8xd91TSPrSCxpORZVWY3sOAsObRB8GbFBsp/fzQRNavyaWx10fq8zTZFwuOCXmthxqT41ualN+UXPG8mbZW38Wk2x1mL623nk1oUDl6eSqL8wajLR3DYwzE1NQRdQYsB0bdYzTjPFUrugHDKC41a8PgSNJ9Unb3gBMcGFtDq9h+5ff53TxtFNkbjmPJnd+MnjB8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCxZ0s2rCAAF8n9zAfm4/VfgFA0v5dlIPLtSk9ahlX++CQ7v/yCnYaByWj1X6ry149oCVxcI0TfEJjbnqcBXhpR2Y5s8UbR58XURs+e8usXjxGi5+1qDZgxlx1VJ+FghIvpeQ==]

profile::monitoring::oidc_private_key: >
  ENC[PKCS7,MIIOPQYJKoZIhvcNAQcDoIIOLjCCDioCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAYazIP6aCEY0/A8qBHSy/685WxkbpXYeLhP278vcbrQVdX0I6AN6RlKhI6VpiO7lwZqEtp3bjg2DeAztF+FXQXRd+Kh+jPIDrOFCgcnS6+c8hu8jMtkBscYdPq8n32p9TT6O/c3+np1ZYIt8pG3m5H8FdP0c7npWydFQT5bcv/rqIA9z2r7yKL4cs76GV4X/3RVRdmQwSVulW98Ly/7ZQ7KX+cgOI3yjqGdE+lLPFjTA59VWr1gg9RLasoX0V9MyLmUS/7kPGT9a+mRntcps+ulCeA3HRHGZzKL5Tem3LSSQxB+xOefS6fOUTiTCyvh5W7YPj+W27Yaoacekwy6B2ZjCCDP4GCSqGSIb3DQEHATAdBglghkgBZQMEASoEEPqDX+tBVarOrcRCxP2xMYyAggzQjPa6ZjsOgOQG9zqKr5yAEgx0J8SSCgarkYTaIHv22pMZd8pMirkEAbTbLP6fztoqr8mMZrVTxuGTPIv/Qs73fVJ3agcQMW6IBvGBmnOO2SQR2i77NM8fDaAvjnFoyYZuY3kOuo2T4N3KX0mUdpyD6OGY5BcIn9ka2i1CN1xnglR66r0QiuhU4elO2lAp2RXS1ijMdmOJcISS7ixgN/AGtXOO+U4c1k0U4oOUZPEefW/nTdGK8mrYpkSUaRPEBUbTmduzbGOlt/XDO9/rnUPC6sGAcEjSiMJXgDnaOIBodRr0DqJWDcpKcB9nzgrgBgTXX+2bzyI4/dAYmhOC4WjE11wXxhwV1sRZBmuZJrs81HoMYW5X+OfBgKEO2TKnpw9VM7/Tm/0QBS+AMf5lMwc+I2j/qMGBGiwpacmqdWNqqnMBHU9U8NvLo9CdKILAt+YWglyyj3d6nJrGUNwN5HYkD1LoX8Poc9cb1jPi7RYyvkicKLrOULNelZDFAwmnw1T+72RoC+b+bNH7pswH+C4zANaE70Ds/Y08r5pxBLEsFwEIf4F6huPdSTVv3bYsvexMWOxFs5CShDSh1pD0xo4tZeaTNVwfxYu7G7Kuo/fOKbfxKmQ4Pmyc/r84KLK5cUiaEMdjsfdziMJpP+l1c2YJfDuTB5Oy4OyyFgdszbL/eQExUFWKQl1ttaBIxx/kvEl5qZLV/zdOfqEYjDePkFDp8PQVDooytx6SthyflwuEcY7xoFSpMlJFFOaBm5bmHrSKiRgclsOmSVDxStz55GgfQFQuxXMgmf5Liw76vlimyprNd1CzCuLwg3u0n0kESeyDFhFKmF83QJlFBva2Z51k1qmkXFLooKIGG4pLWoE6H1JHTUu0tna7WFmt2CEOAnrb8clL/dlD1ZtNq44qen54imRwEpPWiED2UDQkJV19IcOCLJsJp7HAQVB3mmX5PYCijRLPJIj/aUVv9shDPOw2B/rXnfAEOzIhxVD/kqcfmxOGuzJDQlwn8Qe683yEmHVfE/Kkt+0OZufKWO9dL7i/YfbwvqSOPnV3jV3t8idMYw6482D6te656CqP2giggD+cWHl/2fCbXCbSDLoH4QEMQeVXovIFPeNcqAuMKGxzyA5t1mWg0yEZ5dmLXmEQQp71JxFWQ6GQGRzkNyHP+1QQau4n53R1BP2eFycfvKvah+k/Ys6NyZUzTCV3nXiDyFQT0/MB1/sxbCH16KOmr36HlCVUnRZRqASVuWBXd9cFP8yNPJMLe0ZTUqKFdH/KSfzYt2mq4aluM17gb9NwZbHyhDmT6fnSfzNrjTZqPHIpEr0oV73jXsPad/I0Tcyy6Iy3my3RZppQlXQkgI1j8Fk4lyt7vKiwvnJkzEWbHmB2CEenguoXlhBdaSpf/DWiX11h2HJ3M4Fb2ZTJNxqrldgfFqVDZd/HrQOD4JfCM86LOYcZmqKWZmx5FBxs7AtY7lL29zXd+xc4zhahPu3hRpVV+7MWROIACfbB/jsaBjyT87JQU31l+OunvwQEJEpmpm3vtIwT/35vZplfjfR4hg5MJdOG0GljKpb1VQbOo/pYMBDpWptbLIVTHVnd7nOolGht8wGylSQRnf6nVL4PpsMRWmyH5yIHtXP9sXiCQlhpuJPVQB2Rwsz131EjvNHUFnIawrVrPihtMJkNq+1Y5WDIE+zchzwyCh6A+W0732XoujYIHfGWuC9tMPv6A0EYOSN7UCD9FQOSidTO62f/73vHFLyhFN4LdEZtCf+fsXlWCi2hLHdqiyfRcXULAYFmiyi+DVqBL0cjdnBmMaA9JQAMMh+aaj/qBvJXJe7bSLEeGmGKpBlbptZa0K+WLhG++TNe1CpNCJDg/BkzinC+SqUYtElqj0TuDJMmKbT8qRJEpSNUbdeR2+mUxOBLv0MTyw2N2Cl+zV4ByX63Um/kDOOIokG2BiyIakom52PeEswXg7kIBLKrbpITpm8+e9yJwMlQ9RI6YVzpFthUH6WzLVk94bkoEfSk2CvW4VGoF8QZI9Hly2Fekcy3MS9BnlzfG56yJRIfn89pyoYgxUkqZBVVyKr0X6p/KWY6omfqDhnVklaIKV/QvfAeuy6x0ZBm0agFoSK3KiuGBMgEcyux5fVscxDry14KHLU/zfErLVo6WHGLA8X/4EFq+rpkY0Om5/B4py+5PpHsqsouVsY0bs/bcZgWbGKbHlMgl/BN3FmwSiXE1rvtpL1Z6umHwV9O9FseUGcZyHGyhOj95CC0nmY49ZZnTYdj1mI+L+tApV1/e0k2DHUy3iIR3pVzi8SSFoFB/MrzLR+0Q01PyyEFfqYxSttg/ScAoWIyTJUtPQSPld5CemEaNVF5nJX3/tXp8j4opGcy6yg1F0yqa4+k9bGedLd7GqFW69voPYGX6+lRxyBI+5wABIbExnXZCfkdVV31wtWtKSZVNpGgttx4I9rnFsfEPT5/18RfuWLKLdJryliH/mmRSsH/1bJODMvb4pr2A5Cw2VubK9hqduQecpREM7YzaQTAMHzfblCehXrr2duDpLJ7dJHNctJ4PLR7g+Q0tdw8xu8eoLnPHSXeIOqiu0SiOrc0Xw2Z5EESwbnKNEBGW9Xizl3lmtTE+xmOmxgVYNSRc2BZGBoLIVULt5P3G45UQMu14wcO2htnYu5rxqNIwpMFavVwvIccw89iu1aUHDkvknSIKWZeRp2MKzGX5++wwDEn8xp8VVeC+DvzALWs+1rMUGs8DCPAxP+GkJ2Dus8Sp8fRrFk5/fUcHUnsEPQqShWZcPGe4ya5AFZNuWdIrYuDtc4js7WPva8N88HEfq4gC268e5MU6vPD0RbooW2G/8zu6rugOTTNroj4ctMvZvvc7qwXf/zj1nX1pbnP1v0dGWC5FLHGQxuTE54fG9Cmyk7y5ci4aOsY6LqOZkGQvqK4Sy1bC67wGZS+/2AOgHOJmFC49jhwoahfKJ5JGFm5lUyJkAphj9QHxPOyYx0ZHZ0jdHx5AopnSW1arg8M7DriHJ2f2rZ1Aoei7OyuXOkUxczk65mJMM9vO89jwwwxqzsZV8m7UyZ6ZFGu8q1Fx/y5KZokUHjtnHFHLyx/baHor6dAQRr8LbuVRbmz/42V46sH1wHFr3ns4s3MJ8MyZnVoo3z8pYtYQuXDsRuwN+0LEZ4WtfFNvIh1X+lQY9ngr6p77gOTD2FFPytqG4aJ5ENdTcULiQiKw+hwy01ldl2AETMmv9kUitfSWWXN5SUT2Sdwrv7GGmSFoPrKaUK9f2lzYhozAoc1K9Eyv4w/5ZszRhtWZx7N6xw6F/vBlJr52h7k/KSxgtqD9Pl8P7xar6rUqZrjOMQ6quVI0JQKNlpEDDvsXRTyYJGxERzLk5NDrAkrDgGICB4oN41R1f6AHkdRtI+T0nAw4Rs06XheXhvtgR6LgWiu6IeiVkbO10AZ1fNxZbYmayq4UuHoPTHPL9yBR70tYJaVis9MEtxr+YtA0RMUHwHVessIzH/T6sPEzvuBXAnzsw8xjH99Uzeo4z7Klu1WiGQKeG6LKLlQwtvUInjYa8b6N1gBm2hkqD3CaY0UrV6zQI/1FUmOsp54m2RHggGLxbTzUO2JCiuTz6m00Ob3/xMzl1OCWmtbUyXkXW0pn8hW2mrEyHS+sYeTPhX3y0X9OEOn9iMtod7bVTZu1lnOZZFLfAt+76oByIGL4wDjD8luRb5Ztd69E61S41VcPnb4TOeCPh7vC7WTSv6VZjnwgmXv3X6ecpQ3hOHOPkgjktXDBYEMVEk+Ulmr8KWsLZoTQHiwSJbc28+IN7UGon7P9wAeMK8saugSIMcWh/95EeN9PQoqqsVKwVrOtlkSU8BXtAJnjrqU32gH3rzf+rnBoK1ih6j4BHnWSCCvI3IMoxsDopUfHtBiZjKcVyQA6j2U9xtVWUKu3O+WKjgifFb6R9JokFrysz1lVzs1wx111UnKZxrkamYMgThugqzih4mNrJiIZP6Fae1UywQRneIWFkpQz/zAcLaPDtNQexE+qEavav0tkHB0Th/pIyIF6p9Lh4WC71Ums6wdX8s5PGjg7ZuTMl76Gru9Duj5JKm2pr3rfEvSJAJ1cF3DRiQ4pTJw/e+08l6PpyNGCD2Xaa4O+Anp1UH5uYnKThp5JG07fuq5O98d6cwuTR6NygcQ/2E012dqorC2z92vziXSahOdXsl0iV7RvzLuUb3Q8jje/QiAYTX9Du/rhiXGOt0ON8u+3SPB1WQSMIer5O9vVM1KtV+h6S6W2JJ+hHzxuf6zVSUnKAMs3KcFSe+33QrTDamjM+WUEqstDHucGzyg2r9XrltpWERVc3L9UAE9xU/leKSBZsI+NC86RoKFSvjCuIZwD+v/QT10PQQX6w==]

# SSO Users with encrypted passwords
# Generate password hashes with:
# docker run authelia/authelia:4.38 authelia crypto hash generate argon2 --password 'your-password'
profile::monitoring::sso_users:
  ryan:
    displayname: "ryan"
    email: ENC[PKCS7,MIIBiQYJKoZIhvcNAQcDoIIBejCCAXYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAN3UWovL06VBXM4xuWZoneDOQcUXKn4Os5Ox2l+KzO0YpeVzZ8pwLK5DWkBGkt5nyx6MIB4791zk7qjlThl4S7SfCNopmfpP9yxIiPt0T5RV4ElwMox8hXYCRSeyKty/OBlgQaxRMoKaAVQFMCbvAxrAG4apU3be9zB6fZXjALZ9UHRI/6izAapm2JnyOST1K153+Eb/D/sLwz60BNKF1OXM7EGwN+wiWT8Db0ZrTQQaw2j2VrS68/RzJp0QQxIMdcPfpo8IBmgR4dtwQB0Z1apNUWbKJeiO1GLA+fKuFsoy9sISR0fu69Qk4ZPZ0xzU9uY/074whG/yvS/QTOyTQdzBMBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAiTt9HQvpyqD+gX2aulL6vgCAlRGb4v4gKJiCsSlYYv2K3LAGgldahCXUw/+N+/gFehg==]
    password: ENC[PKCS7,MIIB2gYJKoZIhvcNAQcDoIIByzCCAccCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEANipt56G5B2f45cnM+9bYUkqALpxJq9k4oKohyYJVAWcGOX3O7/h8aor38Br0zxxkpSbcnUycx/Z4s367tcWDZoTX8NgCA+XtC75/o1uX9FGOSW+FrgETvsBlC82UPA7H7jaGM2kgPwBtprVg+MNx/8NSAkgMmSGxc4oKv4E+l36u5gr9HWbLz6IN1J9Ha7ewToIrM38JxRimH9UNSlV//wYdRqhtq0fSxpn+G/9Zp/hn7S4GkQx++xQTU1mtha+I/p+yk4AGn439gO0VBCyEX7TYSaQIOiMltazTRaVyIBiJ9s3MiUUHJiHrsBhAGc9y7X8NSlkMk3yWvfqbQgTlaTCBnAYJKoZIhvcNAQcBMB0GCWCGSAFlAwQBKgQQahzOVCUI/jejDBeKoz4pKYBwP477vlRTbO/d5KA4N8qqHAHeUFANWhGNvo3+CMX9Ao+iGY+mhBCbS2ggXf6X2D4GwC49WKt00z7r90DGu9JA60XB4b6eIFSrTwLQQZobCrfWQ8ysGKkNsmEpoC5qFMT3iv+lGFmf4TC++NCCS/XEpA==]
    groups:
      - admins

# OpenTelemetry Collector for Claude Code monitoring
manage_otel_collector: true
profile::otel_collector::manage_otel_collector: true
profile::otel_collector::otel_dir: '/opt/otel'
profile::otel_collector::otel_grpc_port: 4317
profile::otel_collector::otel_http_port: 4318
profile::otel_collector::otel_prometheus_port: 8889
profile::otel_collector::enable_grafana_dashboards: true
profile::otel_collector::otel_collector_image: 'otel/opentelemetry-collector-contrib:0.91.0'

# SSH Hardening Configuration
# Disable password auth, use custom port, and other security hardening
profile::ssh_hardening::manage_ssh: true
profile::ssh_hardening::ssh_port: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEADK1MNVCcoO7uMEuEJ929Z99H5a7Uk33oq6oJeGHY7wPqPIXiTWc8+9OYycZJ8o9jwO7rgByPgVa9hPLqyJy14iZsqD6yrdQg7oMu6/TdRR7Drijzwj3gCisD1MM5KqirKkjRQDoYwDIktQZsyFWGapEHT8GH9Z+NjtPRc+JnSPDYzZw5U6xetabpr2hzeWQxK9CFO3j5nISuBS7HCEI7RavHyqGBfYg2o0XYjSEhK/o7IZEasNTPezH8j11iUuwNBoVNKdv2MtP+VD9xLvjVPIEk1pKNIIlYI38szUWwEsPf/w4zrRcDgo5mI5HmLktO+/77ZUqQobccLWi3fAjypTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCDQGleTWNzrKusDA8unOEsgBBMTOSgimO1W9INOd+tiuED]
profile::ssh_hardening::permit_root_login: 'prohibit-password'
profile::ssh_hardening::password_authentication: 'no'  # Key-based auth only
profile::ssh_hardening::pubkey_authentication: 'yes'
profile::ssh_hardening::challenge_response_authentication: 'no'
profile::ssh_hardening::x11_forwarding: 'no'
profile::ssh_hardening::max_auth_tries: 3
profile::ssh_hardening::client_alive_interval: 300  # 5 minutes
profile::ssh_hardening::client_alive_count_max: 3
profile::ssh_hardening::log_level: 'VERBOSE'  # Extra logging for security
profile::ssh_hardening::use_dns: 'no'  # Performance improvement

# Firewall configuration for VPS
profile::firewall::ssh_source:
  - '0.0.0.0/0'  # Allow SSH from anywhere (consider restricting to your IP ranges)
profile::firewall::ssh_port: ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEADK1MNVCcoO7uMEuEJ929Z99H5a7Uk33oq6oJeGHY7wPqPIXiTWc8+9OYycZJ8o9jwO7rgByPgVa9hPLqyJy14iZsqD6yrdQg7oMu6/TdRR7Drijzwj3gCisD1MM5KqirKkjRQDoYwDIktQZsyFWGapEHT8GH9Z+NjtPRc+JnSPDYzZw5U6xetabpr2hzeWQxK9CFO3j5nISuBS7HCEI7RavHyqGBfYg2o0XYjSEhK/o7IZEasNTPezH8j11iUuwNBoVNKdv2MtP+VD9xLvjVPIEk1pKNIIlYI38szUWwEsPf/w4zrRcDgo5mI5HmLktO+/77ZUqQobccLWi3fAjypTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCDQGleTWNzrKusDA8unOEsgBBMTOSgimO1W9INOd+tiuED]
profile::firewall::allow_ping: false

# Firewall management (controlled by profile::base::manage_firewall in common.yaml)

# WireGuard VPN configuration
profile::firewall::wireguard_port: 51820
profile::firewall::wireguard_network: '10.10.10.0/24'
profile::firewall::wireguard_interface: 'wg0'
profile::firewall::allow_wireguard_routing: true

# OTEL Collector firewall rules (WireGuard access only)
profile::firewall::custom_rules:
  otel_grpc:
    port: 4317
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept
  otel_http:
    port: 4318
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept
  otel_prometheus:
    port: 8889
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept

profile::monitoring::enable_external_dashboards: true
profile::monitoring::dashboard_repo_url: 'https://github.com/ryana-0154/infra-grafana-dashboards.git'
profile::monitoring::dashboard_repo_revision: 'main'
profile::monitoring::dashboard_auto_update: true
profile::monitoring::enable_embedded_dashboards: true

# Grafana plugins to install
profile::monitoring::grafana_plugins:
  - grafana-piechart-panel
  - grafana-clock-panel
  - grafana-worldmap-panel

# ============================================================================
# WireGuard VPN Configuration
# ============================================================================
# Based on: https://psyonik.tech/posts/a-guide-for-wireguard-vpn-setup-with-pi-hole-adblock-and-unbound-dns/
#
# IMPORTANT: Before enabling, you must generate and encrypt WireGuard keys:
#
# 1. Generate server keys:
#    wg genkey | tee server.key | wg pubkey > server.pub
#
# 2. Generate client keys (repeat for each client):
#    wg genkey | tee homeserver.key | wg pubkey > homeserver.pub
#    wg genpsk > homeserver.psk
#
# 3. Encrypt the server private key with eyaml:
#    eyaml encrypt -s "$(cat server.key)"
#
# 4. Replace PLACEHOLDER values below with encrypted keys
#
# 5. Determine your external interface:
#    ip route list default
#    (usually eth0, ens3, or similar)
#
profile::wireguard::manage_wireguard: true
profile::wireguard::vpn_network: '10.10.10.0/24'
profile::wireguard::vpn_server_ip: '10.10.10.1'
profile::wireguard::external_interface: 'eth0'  # VERIFY: Check with 'ip route list default'
profile::wireguard::listen_port: 51820
profile::wireguard::enable_nat: true
profile::wireguard::enable_ip_forward: true
profile::wireguard::manage_ufw: true

profile::wireguard::server_private_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEALqxRgspHM7e2xL+KUMamyRP783by5MEb6m71SaCptqMoSx1vBCwcdxXrePRypJu/zGvzhQKwgl1CWsxoRYegJSfrW62WJprFMH9sj5B8G+r7/xmD/HUoQh/2bKfHeMaL5m87CNGIM1FZktf2mE4RZ+6xCj/fGEj/4W82W/iopL4ihQ855ziL0EXlN5yvUlkzNDaUYrPQ2V2MwLAPDcA21g1wAnLglPsshRCtfssqCL5x+oh5N/RwHs23p3czQ9W7AN3xCovqwKXrCvKmPnHUCoYLC/iGb5iYwTR5GJ4jnLu8i9bsf6WNhNsABErLYwIW1OnXtdKN2KYagRMCuLsTpDBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDgelDwkbbHcFfyxEDd8nvggDAB64Pml2k1PgkkS2MdldwQ+ohZnVw7N4anUamtcSEhBBmllFab7wOArjzWXkpjsOA=]'

# WireGuard Peers (VPN Clients)
# Generate keys for each client and encrypt the preshared keys
profile::wireguard::peers:
  desktop:
    public_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEATBtk+7zZpXglNCjiIFi3DGag/opI7+hrorrwJAFJ7xglyncEuJhIluICsTsp+KPneFXlnrQ/ok2VSKgk9p5efgkcMpPQeym7OIOk5OeCVMQSTfUsz+12IrWMFkLUIQV/OqH1LHSQsAdZ0wqEANV/zgXpG35kp263ABXZDKfF7wXMmPK+Q0TCG9y4gBUngJh7aQvZTf0oAEx5A6z/iZey8glBI5UhYEhLawfSXWYyBHFWktEJhiYbfBtfXxg1Y/ziph2GSDrqg7h4GTparxLyQ+PWq7cUI/CJ5XSz7eDAq8aQCuFvViTE1tV17VhusTdQRftDL8J+1531ZuYVwjaTiDBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCNyYgDZbCFIcwlFEOgUZregDDug82fE1mBiDSN5VRPUJUhTFvy/xRThvZn1AHod1r9iGEfDNJR2FrhxN+AwqVvRmg=]'
    preshared_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAmOmkLq2MDi8cw8cEeNr8rOaoQMtrxNBI5kAkCjxPnmqhVw13s85QWpl7TwotrIL/BqGzx4L8i0Nhaa5q9uUTx/A3+vCq1Q11qXH5u4CnhdzlpvGz6WKCrgueIXdElLbbRcVbEFwIyOrnoIF550EvRRHtueTbySIgYfi8Wcm9AA/y4skG1wAqonhmivoYuxQGqP84VP8MMiCffvteH9xbjBdMQp2zyKF0bDcQGwUFwLyX4roQ+9r6ChDso5bRYtwjYFI4svNI2otF1LsRqQHbfMJWRPSiC8QHbI15luW8iep0dHXdewT1G9m/3Z5tf4CwnGfn3bBMvhV8rJJCFt3uqjBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBTBuk4NJ/ijjoTn+iAZh/HgDAitTVDLqs3KKnBjY2l8UYD0rzvK3T0QGFjPoMo11aCeFEgZ0PUPwx65OatdcoHMa0=]'
    allowed_ips: '10.10.10.2/32'
  mob:
    public_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEABycBFYPv8oa641TdaVLyzkP3tfBsEnSm8UeqI8sI/qde1+VK1lrjWQMhVUMr1a1DczfcA12sxxIkDiECFLSpaj4+9WzK/n64IeHzkcsitWHgVDSqGRcMaye2y0Zpho1NuiuUSpPEZtWRbWvzh1BYtof65fPGZUSDBPG+A3QBa2gjMMiWkxcvohJhTGZcO6rq8mvLXB3hlBXgayRpeHWHB9cs4phPKvHJxjpjedmLZdBQGOdVCy1fo+MP95KtlPMcdD3ZB2e4EUDbuejkuNjODb2cig1+f1HjLG8mfo7LO9RUXbeC+lsTC2a0mHOs/CfNk6lcnpVc0jVHy/eev1+M1TBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAa5wcO0Rg2G3mbvV048ep6gDDdC+GbN4ea0gDp4rzT4HJh17PkIXPQ6gc4JKEWau/5wHwcNOGB/h4DLnsUJ8E7ZGc=]'
    preshared_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAH/v7E1xTITDJud05fqVle1cCy1tZ6snbi5ANLfEgyRPjK6Y9p652evnCHSNSDsasbLriDA356e0Z2z11F/45MJQconOAesCir2Mb739SuFPwXsl3VGl8x0vAAbFMYmJzdLHYqMVTEC//emiIQa8DvQeAfuIrZoNrQgtcQQw5IMqSRsqh2yGOzZAUd1SYrMTNx/tBw6WOxbmCA1pQjRQqHLmCQwh5d+8Xhi0TbG2eQ/yzJHcyEeRH0QxwTMZ/GrlFp38Dloj0+aXKEXjRiq7p/OhcsgYPY+2JnqBRxN97tK1PUys18qDdDJyFgghszdAKanfk1+0/WOMZFJxPQl69ZzBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAWstEiQ6TGsLl9dS+UoEUCgDDFx6sMJHB00b+b6D5Rn/OFOFHZe7VvYj++gYTvv026UY1rBcYWYaB1dJ2c3PZHXas=]'
    allowed_ips: '10.10.10.3/32'
  udr:
    public_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAHkEtk1L8CFHtBg7LuJQD6nKoNNB9Oq15/laPfblva5uzcHxe9rn0xyUwHMJP9HT42GKYnXksaoSCAhy5BHawMoUsKmApTB0yFROnIESaSwe0hU38MnJUL395db11UbrLGruM+JdOLI/0xY0F959yuoYfpXhfz5yVLrs5ZbyEKPueQjZrg+pB8d/xc4vc6auE2KvF+IyLIq8xJrHQ9IPRHVNoNCBeWPvXWCntS5+h1nuTPvYLXI70OrULbTUZkIlHpphKM9gtrjro2RU6fO9sFZ1942jbK1SzvU8Q3JqQJZmvZcGyiB+iD5pu6y7C2bvN/BecY6XXLs2x+ZsENPC0jTBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAxDQ9UbVPAXLCBAasUAU0cgDBAg3XZWqCggsU4grpb9mVTcw4WOjtvJ4FcPAbO7lEv6m8yryYsq9Vd4pWgIFliEf0=]'
    preshared_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEA9arnkCr0n8DD8t1a/oakZEIHfSDds7VVtzClvBL8BPVgaFIyMtHif3ppsauKHNKIJYokSgMqFDtewX6rZSDCZ2adCuVmovw/nR4Q/HXP+RwseVMyN1twXjZfNh5q/Twdmt2udS/L3vpwnypKK6Hd9eSfXAPYAJYpDj7sjH6Bj1PMAv+5j1aGQv4JhIJ7yuO0HkbrQTOjOhGE1re/+Ypu/TdqtIrcQX2RdsTFO30ayd+ausJ8q7SJbMDyBYtk3Z9E5FiAE4YUAbOd32M9bWIKmp8qDmZZ7qjJxPO6v2rPEakD/92eBKlNRo0IxvVYP/7w0ebG18juYAzj+WrgKwpM3zBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBWkjgmsQYaVA9DVKAqWP+EgDACSyVMnq4vaXh/l80BWRoKSdEZ84SnzfwqJEPHc0lJbLg/NtqdQa6pmrigUvVC9d0=]'
    allowed_ips: '10.10.10.4/32'
  pi:
    public_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEALiZag6hLXh085lgQ3DgHrezkRkKiSMJHVadxKP9elkkTz78OPDgIntIxEuPOJUrEM4AogtMU0izG3xcaIAj95j0vZIMDW8fGyoFBMCYaMz8iXVpPnx0+0OAsCoRkqCOIw2/MPlw7FJJLzba+OUykfAO4UeGVF3NV/ULQ2B9AMzXKKsNXBobZBz775oPR7Qf1LGcS9kohpkhae1Hj2i2lIfZpCUn+4RHlBMBv94TYBJXCVaOtIOk8mNf6IVd6+LNLbB9RIG005Q/DeG5RTStBibd06UfBhvyij83EphHhd27E1SeAdCLjd8uJvUz8w3jivKyXZDk7EcxSsUfWM67pajBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBACr3dLvGWe3dfOtWxyOG56gDDk9ZLAffvcQ6oHfe1WqJDudiC9lYume0cDTil9xbRgeTOc3AZXdq4ljwpZPoRu9sM=]'
    preshared_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAcn47yR7vF4rQhDPMB8y4D9xHNxbFv7/6pvhMfzFcUrGfFAFTzzzHC0U6INUUhCFpJb10YRjHmGG53y9fESK1OQTHwxfgrSFikK5SjqLrx/jAUehot+lmPFrOd6ByaByf1idkiAdJrFM8zizu5ioToci6kt7Cpk/qKCF+6F/N26/zSEPu5VUgIHrs7pfDb3dlKexkzaStOaTHFS9/vb5wfm66O3Y4qz/rjGR0GHQ8hGbMftvZLdCasB/L2XkLwijf+iXorRcN1VQjyKdV4Rl3J+NvQ8oVrIVuH0XY/k+ePWRmQiYlWE9ZpGblN0xtUmejJfq3U5rcAaCj3xXSX4/ETjBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBNpwZuoUBJyUcfHgiNlju4gDBvTO0XhJVrySxBd1zNHA8TBxsQXXTFovCkb9qE0P7TgB5zZfN4AR0uMdH4DE/B6SQ=]'
    allowed_ips: '10.10.10.5/32'

# ============================================================================
# Pi-hole Native Installation Configuration
# ============================================================================
# Native Pi-hole installation (not Docker-based) for network-wide ad blocking
#
# Puppet will automatically install Pi-hole if not present (idempotent)
#
profile::pihole_native::manage_pihole: true
profile::pihole_native::install_pihole: true
profile::pihole_native::pihole_interface: 'wg0'
profile::pihole_native::pihole_ipv4_address: '10.10.10.1/24'

# REQUIRED: Set a secure password and encrypt with eyaml
profile::pihole_native::pihole_webpassword: 'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAhQEC0uzDiu6Hi40tYToJQw2cJ4iOY6afssakMfB74W6cTwBPbVCDbDvdZUdhT2rhhVhtbqH+AG6smHdkhM5TbrWNiyQkryYf9ajf7OEKgQh/QRZvnkIn7WgvKbApkZXrYcOz0Nk8N9kc0x9FxuZuY+bIKhGYYEUnTVqakeAwjzqr5FJsZpH4EEpa+012Tgvbbh0OPA+sGmjffc3IR8Sv/Nej5upn2ef/769nGl/LBSiLPgppjQatworDIkJ9/J1EzEsUeXL2Qo6KPUKruCAjBUAYXUdkdgSM+UQSJKN5B9Blm4BxQ5+wFOt+DQUhIKcAG7dEkfcPZHTkxMgae1MXjTA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCOBM/lDdp39fRSSbgLslpVgBBG1Rx+O1AwP39C/Fh8JWDa]'

# Upstream DNS servers (uses Unbound recursive DNS)
profile::pihole_native::upstream_dns_servers:
  - '127.0.0.1#5353'

# DNS Query Logging
profile::pihole_native::query_logging: true
profile::pihole_native::install_web_interface: true
profile::pihole_native::install_web_server: true
profile::pihole_native::blocking_enabled: true
profile::pihole_native::dnsmasq_listening: 'bind'

# Local DNS Records for Internal Services
# As per guide: home.server for local LAN access, travel.server for remote VPN access
profile::pihole_native::local_dns_records:
  'vps.ra-home.co.uk': '10.10.10.1'
  'pi.ra-home.co.uk': '10.10.10.5'
  'puppet.pi': '10.10.10.5'
  'pi.local': '192.168.1.22'
