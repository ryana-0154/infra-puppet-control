---
# Node-specific configuration for pi.ra-home.co.uk (Foreman ENC server)

# Base profile settings
profile::base::manage_firewall: true
profile::base::manage_logrotate: true
profile::base::manage_unattended_upgrades: true
profile::base::manage_ssh_hardening: true

# PostgreSQL Database Configuration
profile::postgresql::manage_postgresql: true
profile::postgresql::postgres_version: '13'
profile::postgresql::listen_addresses: 'localhost'
profile::postgresql::port: 5432
profile::postgresql::manage_firewall: false  # localhost only, no external access
profile::postgresql::databases:
  foreman:
    owner: foreman
    encoding: UTF8
    locale: en_US.UTF-8
profile::postgresql::database_users:
  foreman:
    password: 'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEARTA3cU6AmDX8cbahBhJV1zMqgNL+A//t3NxF2H2u57p87RyBbC6DdR9YX/PtccMcRRCZcb78dU7HrU2Wxw3bojwJDzMYoeTqz4vPcOFG0J01H5IyVKlsHr0Bbi2NudOROQiQduqIVmE83odjhtOJGUQUAblE5uXD+mBQ7e61no5ihnDx7zGNKqf/L+JLYJ6+CkXkBnwZZf+rAvsapdFiCe4YOtb+Vcls875H8FlP/3TLC2MeHk0nM6/ep/cYuaSWKtgj0ABZnMLxJ5FflQ4KxH+vsu9Ju7ga3ND58DkXH6y4nach5NGFjuIltiA/dxUHi4sqgIQhqgMDa6iMZhM+ijA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCdjc/UFCM6RgIfHirj4fUvgBAv+qlb8A2mKqX+ccylLEzP]'
profile::postgresql::database_grants:
  foreman_db_access:
    privilege: ALL
    db: foreman
    role: foreman

# Foreman Server Configuration
profile::foreman::manage_foreman: true
profile::foreman::foreman_version: '3.7'  # Latest stable
profile::foreman::server_fqdn: 'pi.ra-home.co.uk'
profile::foreman::admin_username: 'admin'
profile::foreman::admin_password: 'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAeQlPpKiNWrDsnk0BePZS9Kjn/6tjQdVgdAPRXIkVgqk0XXiocmYYmnMVH70j682PnhIhudLD2MBTcOVjJH+jJyTZcXtqcyVjhzuGHk3g5PZVeZnkWt11QwYWs30/o+yihOmL81DlnLDc9nbI8S61HDsDMC3SxmZD7nClr/Wh8/7oyRUpbfO+dSVmtPF0JnC0TxIsThAoVm2A+GRK3IczD+1pw9RU/NWnsqKLSf68LcN9Q/PcShXJwNBe9c1JYPZj+rz86RgiAF3piF1R8dkbOEvsJLHMaFXW5tC9mQ8plnmmJpKFqGIJxf+uGpZqMh9LLUt28SfBzwrVCdjjrVtv9TA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBA8uEmF1dGYV87X5QY2JRP5gBD2Wp7ua7VTHY2+aAGm65dO]'
profile::foreman::db_host: 'localhost'
profile::foreman::db_database: 'foreman'
profile::foreman::db_username: 'foreman'
profile::foreman::db_password: 'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEARTA3cU6AmDX8cbahBhJV1zMqgNL+A//t3NxF2H2u57p87RyBbC6DdR9YX/PtccMcRRCZcb78dU7HrU2Wxw3bojwJDzMYoeTqz4vPcOFG0J01H5IyVKlsHr0Bbi2NudOROQiQduqIVmE83odjhtOJGUQUAblE5uXD+mBQ7e61no5ihnDx7zGNKqf/L+JLYJ6+CkXkBnwZZf+rAvsapdFiCe4YOtb+Vcls875H8FlP/3TLC2MeHk0nM6/ep/cYuaSWKtgj0ABZnMLxJ5FflQ4KxH+vsu9Ju7ga3ND58DkXH6y4nach5NGFjuIltiA/dxUHi4sqgIQhqgMDa6iMZhM+ijA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCdjc/UFCM6RgIfHirj4fUvgBAv+qlb8A2mKqX+ccylLEzP]'
profile::foreman::enable_puppetserver: true
profile::foreman::enable_enc: true
profile::foreman::enable_reports: true
profile::foreman::initial_organization:
  name: 'RA Home'
  description: 'Home Infrastructure'
profile::foreman::initial_location:
  name: 'Home Network'
  description: 'Home network infrastructure'

# Foreman Smart Proxy Configuration
profile::foreman_proxy::manage_proxy: true
profile::foreman_proxy::foreman_base_url: 'https://pi.ra-home.co.uk'
profile::foreman_proxy::register_in_foreman: true
profile::foreman_proxy::manage_dns: true
profile::foreman_proxy::dns_provider: 'nsupdate'
profile::foreman_proxy::dns_server: '127.0.0.1'
profile::foreman_proxy::dns_ttl: 86400
profile::foreman_proxy::manage_dhcp: false
profile::foreman_proxy::manage_tftp: false
profile::foreman_proxy::manage_puppet: true
profile::foreman_proxy::oauth_consumer_key: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAntTkBqQjaUJkm/3p3A3NiScKjPlJ89O2mIVFCoOH1/lFipfN6Ipquuhuv9PlBnUbpnxFwUpgPkJwzty6DDpRVqcDT4YTX08+XkSI+L2VKREuyHPOruXt51AUEW4A2O1Wqlbqs9Mtr9WDUEjzTkV5A9iqFbxyLcfEdBfOivwkZzEydXZq+zr0eLDbeS77zFRvNCmQiWn3ttD5CPDRdxhp9KA7fcBI3ka5d5v2fKmRjT9l8MtllI/pSLJbDgRp1ZpwNs0j7kYDtpc1MosDt+MX7arftzQfGXFkFW1YJH+QQcIFpvX8NI5e+2xr8HBS7XeFmRIqQBRO0XbTfjzJQGUiYTBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDN1CYuWIZ+v0udQZtvBJhPgDByiHEXqtiKmRsPm6NhSLg/v5DciU771zNHldNVXGyM70QQEZbO+svjin0r7L892fg=]'
profile::foreman_proxy::oauth_consumer_secret: 'ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAQCowLV52BnM9HCW8D7WmA+uS8merzjw9xeqV0GS4gIUMzaNrSkOf//ry+BISu5yMn/McLr8+4V+Gw7Ergiu+cw7nrNXaH75bB04aEBri8DldnUUjeNUHplMv+hP54ARqRQa7iMXQQ0f4IOayD3np21pTrvDCTJy3fnyhaBRZ6zuFIzVMzr2CHMJGPmR414AJGuX0i+aUXDrU9/HWrsQZbmkEX0uRs7L/QbabTCIHJjcWnEzTAsVDkeGDDpJ25TwyicTh0XdQEXf17sOIP6PwKNP1ZbkyEXQ6VWyByVCmcMknSUgg5uL6h3g09kKUFlmjSr8M8dY6qWiaO1dXfdcAiDBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDEKPQXuGrea3T9olL65EAIgDC8pnm9dSPudaeRNvO+dYYiA8qEyR6QsD/7dT4Eag3cNvhgluzDoCmzminGFTSTBMY=]'

# Firewall Rules (WireGuard VPN access only)
profile::firewall::custom_rules:
  foreman_https:
    port: 443
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept
  foreman_http:
    port: 80
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept
  puppetserver:
    port: 8140
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept
  foreman_proxy:
    port: 8443
    proto: tcp
    source: '10.10.10.0/24'
    jump: accept

# Grafana Alloy Configuration for Grafana Cloud
# These values will be decrypted by hiera-eyaml during catalog compilation
profile::alloy::enable_metrics: true
profile::alloy::enable_logs: true
profile::alloy::enable_node_exporter: true
profile::alloy::grafana_cloud_metrics_url: 'ENC[PKCS7,MIIBuQYJKoZIhvcNAQcDoIIBqjCCAaYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAQwKo1BSDwPJMOIoGkkQZVnK6VZ8kSB58yvqf6p90r4GVM3uWwGhpRWO4MtT/Qny/HPYjVK01y0bpdGe9xXLXYayYTGkr6cEVG+xCqu7ipalqWDdq+Y4yvLEvlrctROW+NCTCOZr6qhtnR78fwtejGNfJB4WTdE94rrrqqV+7LkdD3Ib4YrZGqvd+pxvMOxsvnmHlfbjyIwoxfbvv0RAA66OT7ZHInUvPsp39JtBU+9GkbQXP3T/4ndcvbjF/vBhspHInwbgs/JNofNuRhjIgRPsDQAoMbeCP8FGggcsE3onmSWZq5B03WYZHJJe8nNmonG65pyiD8KYn5WcxOraO+TB8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCl1EJCetHv8LCF/95MS7UTgFChfxM396X9bjWONFpUF3OlyLZKR6v41SPekPgvbcSVCdK6znQyT5k7eQ23oQd84mZNn2N0I/PRxIefT3sfOPDAQhqC23xoyjUq3VzvEVnPzQ==]'
profile::alloy::grafana_cloud_metrics_username: 'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAxX23EyvcV3mHxl9p40w2y5HvzUVlNiLCeuNsPtcJFhCIl/Qdh46X+Wq502P4dbzRsxRyZ4ETJx6L+rPBPNPh7Injj75WoEE5/QFFHSAnWGqEJXWFkNWwalJxlL1HhuTqWC00kfxPx89isRY6HLdWDO00Fo99ekr6UB4k4xaUg0Nz3bfNZ6iQYyyp4FrjL7u8vl8rZSAFUAvQirVxFmcTTGxnIJYWjBCgYbuETFsBzJDz30a7CWKFOZfp40V21kh3Qj2V8qj+ihgdMP9Ds79uK3ae4PHAQBrmrnyKFa/Ag+4sCCWtj3HaQAKMpKxHIqouxYNz7Dnas5afVYiRIyHI4DA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBCN2hbNxwTIRO9vUxQu0pTsgBBgfen32cGABkNQTa/SZMk4]'
profile::alloy::grafana_cloud_metrics_api_key: 'ENC[PKCS7,MIICCwYJKoZIhvcNAQcDoIIB/DCCAfgCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAJZuFJuWkWppUhkV7A66ccHcr0K8DGx0vgccJV2DWwzxEZzGc1haqoo6cE1/DB7honE0QBqFCrjIfEbKgl5qN9V4yRCrXBmH0rSAUBMVRoRAfiLoJKl1hWBg6I0HKvHG4m1dyw+Q3ChnpLdfVHbDpNYkevF5SlQZ5mYJ7Xq0UZui+BB0ZAije3tvc7hdaivs4CYgj0pAOV76qzrZ/aeVxoLJy9hOHlWtJR1jwMxm0YmM8eEVI/dBiS+Qq/5AQqfNM7NfDcL119luaXDYnHQbIIAF/fkEfanUetQf0peYkrySO5zC34gUG4N3K6daAs06ZM2XThv+Un5lXMk2JCJ0bCDCBzQYJKoZIhvcNAQcBMB0GCWCGSAFlAwQBKgQQPAOBjbeWJjyjUT9ZpdngxICBoFW4V85DA3qqp+8fzvkUlC7oYSEJ7m4h/unv9m3gpLcsE3DFVuhnyVY81zbytDSN80kjs5qk7Qwpgx8y2FBI810g7ST3SSid0jY5DKH7u7a6QSqBgGi8PSqPTcRW7xj5YQF4xvRAWLrdQB0Tw54EPMgTHuSVJ6SBKzDHpL0FLjOZPnccPaFk0HOgp6hH2m8k5x1STR4gcvyH66CmlrFFiKI=]'
profile::alloy::grafana_cloud_logs_url: 'ENC[PKCS7,MIIBqQYJKoZIhvcNAQcDoIIBmjCCAZYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEA8uoCzQ5TwqGHKSQxzp3k36lObsrEHWVEy0SBfy90iIt99w73/OYwCb4qHNLeJrOOPkSoNM+oaieobN6/9EZDruTqnhalG1HJbCyz7pNIvrW6BDiRGA5ccLZs9wM2IU+WodPyEh7YbadiOD/QqZg7l1/48ynIPbXHwjdffZWVSUfsXPIfDZLCSyLSvR/kOkrrWaV7s6mcWuJpgepI5/9ffcQ6c8D3q1kAgZnnzbb1hLjjENHpKTT0VMaSmYgV6MMEcf0aBdrw+7K5ZwC3SgwYaxHPCDeqpMH1DC4PGMbystgrDCfRxAtZUH8EzrNPd2Gi8I9oMept12Kuov9oZLID+TBsBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBCJEozGvWs0hjpk90xeUHTgEDxKzw55hVW0Wknv8353dRRwt9/rGe4KzIrBWzmq5vNhM4MIHa5MH4GEY/kRi1Q+IXQ+698T4Cxf7WqS96fnVAP]'
profile::alloy::grafana_cloud_logs_username: 'ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAWju5q1bBfnsAgPlkeoVhAEsyhjjIWdk12R1aL91SFc7f7A/MhDdhZoKlkxxugxX8Oz1grMBkpp61jntukLZEfcozmgYfu9LeL8xBdjOjjRrpnKyn0z0gy0OIMUvs0XzeWuxV/3umdxg2pHb7e46mdInDPu838x21/2uj11uZitXU3U4hZfMUTkCbqCoDA0NGA8dgBf6RqfVoVqcDVGoKFsEzZekFH7F/IJW2Pl10CAuv0bTvnVfliy+C3kEIx/IeWQoGQBAOzACd4H3wIlb3xD41cY4a+DLAtFffgHeXZeUi3Afypj6d9idcGCOmhxCn9ng40lObQeb3cGzjfnJf9DA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBBZjHNkcLyWeSMV5szgs9EugBB/L8xMiaiwckleCfayvNM0]'
profile::alloy::grafana_cloud_logs_api_key: 'ENC[PKCS7,MIICCwYJKoZIhvcNAQcDoIIB/DCCAfgCAQAxggEhMIIBHQIBADAFMAACAQAwDQYJKoZIhvcNAQEBBQAEggEAJZuFJuWkWppUhkV7A66ccHcr0K8DGx0vgccJV2DWwzxEZzGc1haqoo6cE1/DB7honE0QBqFCrjIfEbKgl5qN9V4yRCrXBmH0rSAUBMVRoRAfiLoJKl1hWBg6I0HKvHG4m1dyw+Q3ChnpLdfVHbDpNYkevF5SlQZ5mYJ7Xq0UZui+BB0ZAije3tvc7hdaivs4CYgj0pAOV76qzrZ/aeVxoLJy9hOHlWtJR1jwMxm0YmM8eEVI/dBiS+Qq/5AQqfNM7NfDcL119luaXDYnHQbIIAF/fkEfanUetQf0peYkrySO5zC34gUG4N3K6daAs06ZM2XThv+Un5lXMk2JCJ0bCDCBzQYJKoZIhvcNAQcBMB0GCWCGSAFlAwQBKgQQPAOBjbeWJjyjUT9ZpdngxICBoFW4V85DA3qqp+8fzvkUlC7oYSEJ7m4h/unv9m3gpLcsE3DFVuhnyVY81zbytDSN80kjs5qk7Qwpgx8y2FBI810g7ST3SSid0jY5DKH7u7a6QSqBgGi8PSqPTcRW7xj5YQF4xvRAWLrdQB0Tw54EPMgTHuSVJ6SBKzDHpL0FLjOZPnccPaFk0HOgp6hH2m8k5x1STR4gcvyH66CmlrFFiKI=]'
